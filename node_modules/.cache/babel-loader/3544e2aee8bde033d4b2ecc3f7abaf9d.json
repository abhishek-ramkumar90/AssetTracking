{"ast":null,"code":"/**\r\n * DevExtreme (exporter/file_saver.js)\r\n * Version: 19.2.7\r\n * Build date: Thu Mar 26 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom_adapter = require(\"../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _window = require(\"../core/utils/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _events_engine = require(\"../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _ui = require(\"../ui/widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _type = require(\"../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _console = require(\"../core/utils/console\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar window = _window2.default.getWindow();\n\nvar navigator = _window2.default.getNavigator();\n\nvar FILE_EXTESIONS = {\n  EXCEL: \"xlsx\",\n  CSS: \"css\",\n  PNG: \"png\",\n  JPEG: \"jpeg\",\n  GIF: \"gif\",\n  SVG: \"svg\",\n  PDF: \"pdf\"\n};\nvar MIME_TYPES = exports.MIME_TYPES = {\n  CSS: \"text/css\",\n  EXCEL: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n  PNG: \"image/png\",\n  JPEG: \"image/jpeg\",\n  GIF: \"image/gif\",\n  SVG: \"image/svg+xml\",\n  PDF: \"application/pdf\"\n};\nexports.fileSaver = {\n  _revokeObjectURLTimeout: 3e4,\n  _getDataUri: function (format, data) {\n    return \"data:\" + MIME_TYPES[format] + \";base64,\" + data;\n  },\n  _linkDownloader: function (fileName, href) {\n    var exportLinkElement = _dom_adapter2.default.createElement(\"a\");\n\n    exportLinkElement.download = fileName;\n    exportLinkElement.href = href;\n    exportLinkElement.target = \"_blank\";\n    return exportLinkElement;\n  },\n  _formDownloader: function (proxyUrl, fileName, contentType, data) {\n    var formAttributes = {\n      method: \"post\",\n      action: proxyUrl,\n      enctype: \"multipart/form-data\"\n    };\n    var exportForm = (0, _renderer2.default)(\"<form>\").css({\n      display: \"none\"\n    }).attr(formAttributes);\n    exportForm.append('<input type=\"hidden\" name=\"fileName\" value=\"' + fileName + '\" />');\n    exportForm.append('<input type=\"hidden\" name=\"contentType\" value=\"' + contentType + '\" />');\n    exportForm.append('<input type=\"hidden\" name=\"data\" value=\"' + data + '\" />');\n    exportForm.appendTo(\"body\");\n\n    _events_engine2.default.trigger(exportForm, \"submit\");\n\n    if (_events_engine2.default.trigger(exportForm, \"submit\")) {\n      exportForm.remove();\n    }\n  },\n  _saveByProxy: function (proxyUrl, fileName, format, data) {\n    return this._formDownloader(proxyUrl, fileName, MIME_TYPES[format], data);\n  },\n  _winJSBlobSave: function (blob, fileName, format) {\n    var savePicker = new Windows.Storage.Pickers.FileSavePicker();\n    savePicker.suggestedStartLocation = Windows.Storage.Pickers.PickerLocationId.documentsLibrary;\n    savePicker.fileTypeChoices.insert(MIME_TYPES[format], [\".\" + FILE_EXTESIONS[format]]);\n    savePicker.suggestedFileName = fileName;\n    savePicker.pickSaveFileAsync().then(function (file) {\n      if (file) {\n        file.openAsync(Windows.Storage.FileAccessMode.readWrite).then(function (outputStream) {\n          var inputStream = blob.msDetachStream();\n          Windows.Storage.Streams.RandomAccessStream.copyAsync(inputStream, outputStream).then(function () {\n            outputStream.flushAsync().done(function () {\n              inputStream.close();\n              outputStream.close();\n            });\n          });\n        });\n      }\n    });\n  },\n  _click: function (link) {\n    try {\n      link.dispatchEvent(new MouseEvent(\"click\", {\n        cancelable: true\n      }));\n    } catch (e) {\n      var event = _dom_adapter2.default.getDocument().createEvent(\"MouseEvents\");\n\n      event.initMouseEvent(\"click\", true, true, window, 0, 0, 0, 80, 20, false, false, false, false, 0, null);\n      link.dispatchEvent(event);\n    }\n  },\n  _saveBlobAs: function (fileName, format, data) {\n    var _this = this;\n\n    this._blobSaved = false;\n\n    if (_type2.default.isDefined(navigator.msSaveOrOpenBlob)) {\n      navigator.msSaveOrOpenBlob(data, fileName);\n      this._blobSaved = true;\n    } else {\n      if (_type2.default.isDefined(window.WinJS)) {\n        this._winJSBlobSave(data, fileName, format);\n\n        this._blobSaved = true;\n      } else {\n        var URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL;\n\n        if (_type2.default.isDefined(URL)) {\n          var objectURL = URL.createObjectURL(data);\n\n          var downloadLink = this._linkDownloader(fileName, objectURL);\n\n          setTimeout(function () {\n            URL.revokeObjectURL(objectURL);\n            _this._objectUrlRevoked = true;\n          }, this._revokeObjectURLTimeout);\n\n          this._click(downloadLink);\n        } else {\n          _console.logger.warn(\"window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL is not defined\");\n        }\n      }\n    }\n  },\n  saveAs: function (fileName, format, data, proxyURL, forceProxy) {\n    fileName += \".\" + FILE_EXTESIONS[format];\n\n    if (_type2.default.isDefined(proxyURL)) {\n      _ui2.default.log(\"W0001\", \"Export\", \"proxyURL\", \"19.2\", \"This option is no longer required\");\n    }\n\n    if (forceProxy) {\n      this._saveByProxy(proxyURL, fileName, format, data);\n    } else {\n      if (_type2.default.isFunction(window.Blob)) {\n        this._saveBlobAs(fileName, format, data);\n      } else {\n        if (_type2.default.isDefined(proxyURL) && !_type2.default.isDefined(navigator.userAgent.match(/iPad/i))) {\n          this._saveByProxy(proxyURL, fileName, format, data);\n        } else {\n          if (!_type2.default.isDefined(navigator.userAgent.match(/iPad/i))) {\n            _ui2.default.log(\"E1034\");\n          }\n\n          var downloadLink = this._linkDownloader(fileName, this._getDataUri(format, data));\n\n          this._click(downloadLink);\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}