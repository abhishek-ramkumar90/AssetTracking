{"ast":null,"code":"/**\r\n * DevExtreme (exporter/svg_creator.js)\r\n * Version: 19.2.7\r\n * Build date: Thu Mar 26 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../core/renderer\");\n\nvar ajax = require(\"../core/utils/ajax\");\n\nvar window = require(\"../core/utils/window\").getWindow();\n\nvar isFunction = require(\"../core/utils/type\").isFunction;\n\nvar each = require(\"../core/utils/iterator\").each;\n\nvar svgUtils = require(\"../core/utils/svg\");\n\nvar deferredUtils = require(\"../core/utils/deferred\");\n\nvar when = deferredUtils.when;\nvar Deferred = deferredUtils.Deferred;\nexports.svgCreator = {\n  _markup: \"\",\n  _imageArray: {},\n  _imageDeferreds: [],\n  _getBinaryFile: function (src, callback) {\n    ajax.sendRequest({\n      url: src,\n      method: \"GET\",\n      responseType: \"arraybuffer\"\n    }).done(callback).fail(function () {\n      callback(false);\n    });\n  },\n  _loadImages: function () {\n    var that = this;\n    each(that._imageArray, function (src) {\n      var deferred = new Deferred();\n\n      that._imageDeferreds.push(deferred);\n\n      that._getBinaryFile(src, function (response) {\n        if (!response) {\n          delete that._imageArray[src];\n          deferred.resolve();\n          return;\n        }\n\n        var i;\n        var binary = \"\";\n        var bytes = new Uint8Array(response);\n        var length = bytes.byteLength;\n\n        for (i = 0; i < length; i++) {\n          binary += String.fromCharCode(bytes[i]);\n        }\n\n        that._imageArray[src] = \"data:image/png;base64,\" + window.btoa(binary);\n        deferred.resolve();\n      });\n    });\n  },\n  _parseImages: function (element) {\n    var href;\n    var that = this;\n\n    if (\"image\" === element.tagName) {\n      href = $(element).attr(\"href\") || $(element).attr(\"xlink:href\");\n\n      if (!that._imageArray[href]) {\n        that._imageArray[href] = \"\";\n      }\n    }\n\n    each(element.childNodes, function (_, element) {\n      that._parseImages(element);\n    });\n  },\n  _prepareImages: function (svgElem) {\n    this._parseImages(svgElem);\n\n    this._loadImages();\n\n    return when.apply($, this._imageDeferreds);\n  },\n  getData: function (data, options) {\n    var markup;\n    var that = this;\n    var xmlVersion = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\" ?>';\n    var svgElem = svgUtils.getSvgElement(data);\n    var $svgObject = $(svgElem);\n    markup = xmlVersion + svgUtils.getSvgMarkup($svgObject.get(0), options.backgroundColor);\n    return that._prepareImages(svgElem).then(function () {\n      each(that._imageArray, function (href, dataURI) {\n        var regexpString = \"href=['|\\\"]\".concat(href, \"['|\\\"]\");\n        markup = markup.replace(new RegExp(regexpString, \"gi\"), 'href=\"'.concat(dataURI, '\"'));\n      });\n      return isFunction(window.Blob) ? that._getBlob(markup) : that._getBase64(markup);\n    });\n  },\n  _getBlob: function (markup) {\n    return new window.Blob([markup], {\n      type: \"image/svg+xml\"\n    });\n  },\n  _getBase64: function (markup) {\n    return window.btoa(markup);\n  }\n};\n\nexports.getData = function (data, options) {\n  return exports.svgCreator.getData(data, options);\n};","map":null,"metadata":{},"sourceType":"script"}