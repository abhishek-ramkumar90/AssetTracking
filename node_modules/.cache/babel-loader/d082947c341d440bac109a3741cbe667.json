{"ast":null,"code":"/**\r\n * DevExtreme (viz/core/loading_indicator.js)\r\n * Version: 19.2.7\r\n * Build date: Thu Mar 26 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _patchFontOptions = require(\"./utils\").patchFontOptions;\n\nvar STATE_HIDDEN = 0;\nvar STATE_SHOWN = 1;\nvar ANIMATION_EASING = \"linear\";\nvar ANIMATION_DURATION = 400;\nvar LOADING_INDICATOR_READY = \"loadingIndicatorReady\";\n\nfunction LoadingIndicator(parameters) {\n  var that = this;\n  var renderer = parameters.renderer;\n  that._group = renderer.g().attr({\n    \"class\": \"dx-loading-indicator\"\n  }).linkOn(renderer.root, {\n    name: \"loading-indicator\",\n    after: \"peripheral\"\n  });\n  that._rect = renderer.rect().attr({\n    opacity: 0\n  }).append(that._group);\n  that._text = renderer.text().attr({\n    align: \"center\"\n  }).append(that._group);\n\n  that._createStates(parameters.eventTrigger, that._group, renderer.root, parameters.notify);\n}\n\nLoadingIndicator.prototype = {\n  constructor: LoadingIndicator,\n  _createStates: function (eventTrigger, group, root, notify) {\n    var that = this;\n    that._states = [{\n      opacity: 0,\n      start: function () {\n        notify(false);\n      },\n      complete: function () {\n        group.linkRemove();\n        root.css({\n          \"pointer-events\": \"\"\n        });\n        eventTrigger(LOADING_INDICATOR_READY);\n      }\n    }, {\n      opacity: .85,\n      start: function () {\n        group.linkAppend();\n        root.css({\n          \"pointer-events\": \"none\"\n        });\n        notify(true);\n      },\n      complete: function () {\n        eventTrigger(LOADING_INDICATOR_READY);\n      }\n    }];\n    that._state = STATE_HIDDEN;\n  },\n  setSize: function (size) {\n    var width = size.width;\n    var height = size.height;\n\n    this._rect.attr({\n      width: width,\n      height: height\n    });\n\n    this._text.attr({\n      x: width / 2,\n      y: height / 2\n    });\n  },\n  setOptions: function (options) {\n    this._rect.attr({\n      fill: options.backgroundColor\n    });\n\n    this._text.css(_patchFontOptions(options.font)).attr({\n      text: options.text,\n      \"class\": options.cssClass\n    });\n\n    this[options.show ? \"show\" : \"hide\"]();\n  },\n  dispose: function () {\n    var that = this;\n\n    that._group.linkRemove().linkOff();\n\n    that._group = that._rect = that._text = that._states = null;\n  },\n  _transit: function (stateId) {\n    var that = this;\n    var state;\n\n    if (that._state !== stateId) {\n      that._state = stateId;\n      that._isHiding = false;\n      state = that._states[stateId];\n\n      that._rect.stopAnimation().animate({\n        opacity: state.opacity\n      }, {\n        complete: state.complete,\n        easing: ANIMATION_EASING,\n        duration: ANIMATION_DURATION,\n        unstoppable: true\n      });\n\n      that._noHiding = true;\n      state.start();\n      that._noHiding = false;\n    }\n  },\n  show: function () {\n    this._transit(STATE_SHOWN);\n  },\n  hide: function () {\n    this._transit(STATE_HIDDEN);\n  },\n  scheduleHiding: function () {\n    if (!this._noHiding) {\n      this._isHiding = true;\n    }\n  },\n  fulfillHiding: function () {\n    if (this._isHiding) {\n      this.hide();\n    }\n  }\n};\nexports.LoadingIndicator = LoadingIndicator;\nexports.plugin = {\n  name: \"loading_indicator\",\n  init: function () {\n    var that = this;\n    that._loadingIndicator = new exports.LoadingIndicator({\n      eventTrigger: that._eventTrigger,\n      renderer: that._renderer,\n      notify: notify\n    });\n\n    that._scheduleLoadingIndicatorHiding();\n\n    function notify(state) {\n      that._skipLoadingIndicatorOptions = true;\n      that.option(\"loadingIndicator\", {\n        show: state\n      });\n      that._skipLoadingIndicatorOptions = false;\n\n      if (state) {\n        that._stopCurrentHandling();\n      }\n    }\n  },\n  dispose: function () {\n    this._loadingIndicator.dispose();\n\n    this._loadingIndicator = null;\n  },\n  members: {\n    _scheduleLoadingIndicatorHiding: function () {\n      this._loadingIndicator.scheduleHiding();\n    },\n    _fulfillLoadingIndicatorHiding: function () {\n      this._loadingIndicator.fulfillHiding();\n    },\n    showLoadingIndicator: function () {\n      this._loadingIndicator.show();\n    },\n    hideLoadingIndicator: function () {\n      this._loadingIndicator.hide();\n    },\n    _onBeginUpdate: function () {\n      if (!this._optionChangedLocker) {\n        this._scheduleLoadingIndicatorHiding();\n      }\n    }\n  },\n  extenders: {\n    _dataSourceLoadingChangedHandler: function (isLoading) {\n      if (isLoading && (this._options.loadingIndicator || {}).enabled) {\n        this._loadingIndicator.show();\n      }\n    },\n    _setContentSize: function () {\n      this._loadingIndicator.setSize(this._canvas);\n    },\n    endUpdate: function () {\n      if (this._initialized && this._dataIsReady()) {\n        this._fulfillLoadingIndicatorHiding();\n      }\n    }\n  },\n  customize: function (constructor) {\n    var proto = constructor.prototype;\n\n    if (proto._dataSourceChangedHandler) {\n      var _dataSourceChangedHandler = proto._dataSourceChangedHandler;\n\n      proto._dataSourceChangedHandler = function () {\n        this._scheduleLoadingIndicatorHiding();\n\n        _dataSourceChangedHandler.apply(this, arguments);\n      };\n    }\n\n    constructor.addChange({\n      code: \"LOADING_INDICATOR\",\n      handler: function () {\n        if (!this._skipLoadingIndicatorOptions) {\n          this._loadingIndicator.setOptions(this._getOption(\"loadingIndicator\"));\n        }\n\n        this._scheduleLoadingIndicatorHiding();\n      },\n      isThemeDependent: true,\n      option: \"loadingIndicator\",\n      isOptionChange: true\n    });\n    proto._eventsMap.onLoadingIndicatorReady = {\n      name: \"loadingIndicatorReady\"\n    };\n    var _drawn = proto._drawn;\n\n    proto._drawn = function () {\n      _drawn.apply(this, arguments);\n\n      if (this._dataIsReady()) {\n        this._fulfillLoadingIndicatorHiding();\n      }\n    };\n  },\n  fontFields: [\"loadingIndicator.font\"]\n};","map":null,"metadata":{},"sourceType":"script"}