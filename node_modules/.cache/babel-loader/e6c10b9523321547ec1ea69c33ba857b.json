{"ast":null,"code":"/**\r\n * DevExtreme (core/utils/date_serialization.js)\r\n * Version: 19.2.7\r\n * Build date: Thu Mar 26 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar config = require(\"../config\");\n\nvar getLDMLFormatter = require(\"../../localization/ldml/date.formatter\").getFormatter;\n\nvar defaultDateNames = require(\"../../localization/default_date_names\");\n\nvar typeUtils = require(\"./type\");\n\nvar isString = typeUtils.isString;\nvar isDate = typeUtils.isDate;\nvar isNumber = typeUtils.isNumeric;\nvar NUMBER_SERIALIZATION_FORMAT = \"number\";\nvar DATE_SERIALIZATION_FORMAT = \"yyyy/MM/dd\";\nvar DATETIME_SERIALIZATION_FORMAT = \"yyyy/MM/dd HH:mm:ss\";\nvar ISO8601_PATTERN = /^(\\d{4,})(-)?(\\d{2})(-)?(\\d{2})(?:T(\\d{2})(:)?(\\d{2})?(:)?(\\d{2}(?:\\.(\\d{1,3})\\d*)?)?)?(Z|([+-])(\\d{2})(:)?(\\d{2})?)?$/;\nvar ISO8601_TIME_PATTERN = /^(\\d{2}):(\\d{2})(:(\\d{2}))?$/;\nvar ISO8601_PATTERN_PARTS = [\"\", \"yyyy\", \"\", \"MM\", \"\", \"dd\", \"THH\", \"\", \"mm\", \"\", \"ss\", \".SSS\"];\nvar MILLISECOND_LENGHT = 3;\n\nvar dateParser = function (text, skipISO8601Parsing) {\n  var result;\n  var parsedValue;\n\n  if (isString(text) && !skipISO8601Parsing) {\n    result = parseISO8601String(text);\n  }\n\n  if (!result) {\n    parsedValue = !isDate(text) && Date.parse(text);\n    result = isNumber(parsedValue) ? new Date(parsedValue) : text;\n  }\n\n  return result;\n};\n\nvar parseISO8601String = function (text) {\n  var parts = text.match(ISO8601_PATTERN);\n\n  var timePart = function (part) {\n    return +part || 0;\n  };\n\n  if (!parts) {\n    parts = text.match(ISO8601_TIME_PATTERN);\n\n    if (parts) {\n      return new Date(0, 0, 0, timePart(parts[1]), timePart(parts[2]), timePart(parts[4]));\n    }\n\n    return;\n  }\n\n  var year = parts[1];\n  var month = --parts[3];\n  var day = parts[5];\n  var timeZoneHour = 0;\n  var timeZoneMinute = 0;\n  timeZoneHour = timePart(parts[14]);\n  timeZoneMinute = timePart(parts[16]);\n\n  if (\"-\" === parts[13]) {\n    timeZoneHour = -timeZoneHour;\n    timeZoneMinute = -timeZoneMinute;\n  }\n\n  var hour = timePart(parts[6]) - timeZoneHour;\n  var minute = timePart(parts[8]) - timeZoneMinute;\n  var second = timePart(parts[10]);\n\n  var parseMilliseconds = function (part) {\n    part = part || \"\";\n    return timePart(part) * Math.pow(10, MILLISECOND_LENGHT - part.length);\n  };\n\n  var millisecond = parseMilliseconds(parts[11]);\n\n  if (parts[12]) {\n    return new Date(Date.UTC(year, month, day, hour, minute, second, millisecond));\n  }\n\n  return new Date(year, month, day, hour, minute, second, millisecond);\n};\n\nvar getIso8601Format = function (text, useUtc) {\n  var parts = text.match(ISO8601_PATTERN);\n  var result = \"\";\n\n  if (!parts) {\n    parts = text.match(ISO8601_TIME_PATTERN);\n\n    if (parts) {\n      return parts[3] ? \"HH:mm:ss\" : \"HH:mm\";\n    }\n\n    return;\n  }\n\n  for (var i = 1; i < ISO8601_PATTERN_PARTS.length; i++) {\n    if (parts[i]) {\n      result += ISO8601_PATTERN_PARTS[i] || parts[i];\n    }\n  }\n\n  if (\"Z\" === parts[12]) {\n    result += \"'Z'\";\n  }\n\n  if (parts[14]) {\n    if (parts[15]) {\n      result += \"xxx\";\n    } else {\n      if (parts[16]) {\n        result += \"xx\";\n      } else {\n        result += \"x\";\n      }\n    }\n  }\n\n  return result;\n};\n\nvar deserializeDate = function (value) {\n  if (\"number\" === typeof value) {\n    return new Date(value);\n  }\n\n  return dateParser(value, !config().forceIsoDateParsing);\n};\n\nvar serializeDate = function (value, serializationFormat) {\n  if (!serializationFormat) {\n    return value;\n  }\n\n  if (!isDate(value)) {\n    return null;\n  }\n\n  if (serializationFormat === NUMBER_SERIALIZATION_FORMAT) {\n    return value && value.valueOf ? value.valueOf() : null;\n  }\n\n  return getLDMLFormatter(serializationFormat, defaultDateNames)(value);\n};\n\nvar getDateSerializationFormat = function (value) {\n  if (\"number\" === typeof value) {\n    return NUMBER_SERIALIZATION_FORMAT;\n  } else {\n    if (isString(value)) {\n      var format;\n\n      if (config().forceIsoDateParsing) {\n        format = getIso8601Format(value);\n      }\n\n      if (format) {\n        return format;\n      } else {\n        if (value.indexOf(\":\") >= 0) {\n          return DATETIME_SERIALIZATION_FORMAT;\n        } else {\n          return DATE_SERIALIZATION_FORMAT;\n        }\n      }\n    } else {\n      if (value) {\n        return null;\n      }\n    }\n  }\n};\n\nmodule.exports = {\n  dateParser: dateParser,\n  deserializeDate: deserializeDate,\n  serializeDate: serializeDate,\n  getDateSerializationFormat: getDateSerializationFormat\n};","map":null,"metadata":{},"sourceType":"script"}